(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{9732:function(e,t,r){Promise.resolve().then(r.bind(r,6273))},6273:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(7437),l=r(2265),a=r(9376),n=r(6434).Buffer;let o=null,i=0;async function c(){var e,t;let r=Date.now();if(o&&r<i)return o.access_token;let s=null===(e=window.ENV)||void 0===e?void 0:e.SPOTIFY_CLIENT_ID,l=null===(t=window.ENV)||void 0===t?void 0:t.SPOTIFY_CLIENT_SECRET;if(!s||!l)throw Error("Spotify credentials not configured");let a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(n.from("".concat(s,":").concat(l)).toString("base64"))},body:"grant_type=client_credentials"}),c=await a.json();if(!c||"number"!=typeof c.expires_in||"string"!=typeof c.access_token)throw Error("Invalid token response from Spotify");return o=c,i=r+1e3*c.expires_in,c.access_token}let d=e=>new Promise(t=>setTimeout(t,e));async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let s=0;s<t;s++)try{let t=await c(),r=await fetch("https://api.spotify.com/v1/search?q=".concat(e,"&type=track&limit=5&market=SE"),{headers:{Authorization:"Bearer ".concat(t)}});if(429===r.status){let e=parseInt(r.headers.get("Retry-After")||"1");await d(1e3*e);continue}if(!r.ok)throw Error("Spotify API error: ".concat(r.status));return await r.json()}catch(e){if(s===t-1)throw e;await d(r*Math.pow(2,s))}return null}async function h(e,t){try{var r,s;let l=encodeURIComponent("".concat(t," ").concat(e)),a=await u(l);if(!(null==a?void 0:null===(s=a.tracks)||void 0===s?void 0:null===(r=s.items)||void 0===r?void 0:r.length))return null;let n=a.tracks.items.find(t=>t.artists.some(t=>t.name.toLowerCase()===e.toLowerCase()));if(n)return n.id;return null}catch(e){return console.error("Error searching Spotify:",e),null}}function p(){return(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-blue-500 to-purple-600",children:(0,s.jsx)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"}),(0,s.jsx)("div",{className:"text-2xl font-semibold text-gray-700",children:"Loading quiz..."})]})})}),children:(0,s.jsx)(x,{})})}function x(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),[r,n]=(0,l.useState)([]),[o,i]=(0,l.useState)(0),[c,d]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[x,f]=(0,l.useState)(!0),m=(0,l.useRef)(!1);(0,l.useEffect)(()=>{(async()=>{if(!m.current){m.current=!0;try{let e=t.get("minYear"),r=t.get("maxYear"),s=t.get("songList"),l=await fetch(s||"/default-songs.csv"),a=await l.text(),o=e=>{let t=[],r="",s=!1;for(let l=0;l<e.length;l++){let a=e[l];'"'===a?s=!s:","!==a||s?r+=a:(t.push(r),r="")}return t.push(r),t.map(e=>e.replace(/^"|"$/g,"").trim())},i=a.split("\n").slice(1).map(e=>{let[t,r,s]=o(e),l=parseInt(s);return{artist:r,title:t,releaseYear:s,year:l,spotifyUrl:void 0}}),c=parseInt(e),d=parseInt(r),u=new Map;for(let e=c;e<=d;e++){let t=i.filter(t=>t.year===e);if(t.length>0){let r=Math.floor(Math.random()*t.length);u.set(e,t[r])}}let p=Array.from(u.values()).sort(()=>Math.random()-.5);n(p),f(!1);let x=new Map;(async()=>{for(let e of p){try{let t="".concat(e.artist,"-").concat(e.title);if(x.has(t))continue;x.set(t,!0);let r=await h(e.artist,e.title);r&&n(t=>t.map(t=>t===e?{...t,spotifyUrl:"https://open.spotify.com/track/".concat(r)}:t))}catch(t){console.error("Error fetching Spotify URL for song: ".concat(e.title),t)}await new Promise(e=>setTimeout(e,333))}})()}catch(e){console.error("Error loading songs:",e),f(!1)}}})()},[t]);let w=()=>{d(!c),p(!0)};if(x)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-blue-500 to-purple-600",children:(0,s.jsx)("div",{className:"bg-white p-8 rounded-2xl shadow-2xl",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"}),(0,s.jsx)("div",{className:"text-2xl font-semibold text-gray-700",children:"Loading quiz..."})]})})});let g=r[o];return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-purple-600 via-blue-500 to-purple-600 p-4",children:[(0,s.jsx)("div",{className:"w-full max-w-md mx-auto",children:(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"mb-5 px-6 py-2 bg-white text-purple-600 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 w-full",children:"Back to Start"})}),(0,s.jsxs)("div",{className:"w-full max-w-md mx-auto mb-4",children:[(0,s.jsx)("div",{className:"perspective-1000 w-full",children:(0,s.jsxs)("div",{className:"relative w-full aspect-[3/2] transition-all duration-700 transform-gpu preserve-3d ".concat(c?"rotate-y-180":""),style:{transformStyle:"preserve-3d"},children:[(0,s.jsx)("div",{className:"absolute inset-0 w-full h-full bg-white rounded-2xl shadow-2xl p-4 backface-hidden ".concat(c?"invisible":""),onClick:w,children:(0,s.jsxs)("div",{className:"h-full flex flex-col items-center justify-between",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold text-center bg-gradient-to-r from-purple-600 to-blue-500 bg-clip-text text-transparent",children:["Song #",o+1]}),(0,s.jsx)("a",{href:g.spotifyUrl||"https://open.spotify.com/search/".concat(encodeURIComponent("".concat(g.title," ").concat(g.artist))),target:"_blank",rel:"noopener noreferrer",className:"block w-20 h-20 mx-auto transform hover:scale-110 transition-transform duration-200",onClick:e=>e.stopPropagation(),children:(0,s.jsx)("img",{src:"/spotify_logo.png",alt:"Search on Spotify",className:"w-full h-full object-contain filter drop-shadow-lg"})}),(0,s.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("button",{onClick:()=>d(!0),className:"p-2 text-purple-600 hover:text-purple-800 transition-colors duration-200",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"})})}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:"Flip card"})]})]})]})}),(0,s.jsx)("div",{className:"absolute inset-0 w-full h-full bg-white rounded-2xl shadow-2xl p-4 backface-hidden rotate-y-180 ".concat(c?"":"invisible"),onClick:w,children:(0,s.jsxs)("div",{className:"h-full flex flex-col items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center space-y-3",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-center bg-gradient-to-r from-purple-600 to-blue-500 bg-clip-text text-transparent",children:g.releaseYear}),(0,s.jsx)("p",{className:"text-lg text-gray-800",children:g.artist}),(0,s.jsx)("h3",{className:"text-base text-gray-600",children:g.title})]}),(0,s.jsx)("div",{className:"w-full flex justify-end",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("button",{onClick:()=>d(!1),className:"p-2 text-purple-600 hover:text-purple-800 transition-colors duration-200",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"})})}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:"Flip card"})]})})]})})]})}),(0,s.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,s.jsx)("button",{onClick:()=>{o>0&&(i(e=>e-1),d(!1))},disabled:0===o,className:"px-6 py-2 bg-white text-purple-600 rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>{o<r.length-1&&(u&&n(e=>e.map((e,t)=>t===o?{...e,completed:!0}:e)),i(e=>e+1),d(!1),p(!1))},disabled:o===r.length-1,className:"px-6 py-2 bg-white text-purple-600 rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Next"})]})]}),(0,s.jsx)("div",{className:"w-full max-w-4xl mx-auto mt-4",children:(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:r.filter(e=>e.completed).sort((e,t)=>e.year-t.year).map((e,t)=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-3 text-center",children:[(0,s.jsx)("p",{className:"text-sm font-bold text-purple-600",children:e.releaseYear}),(0,s.jsx)("p",{className:"text-xs text-gray-800 truncate mt-1",children:e.artist}),(0,s.jsx)("h4",{className:"text-xs text-gray-600 truncate",children:e.title})]},t))})})]})}}},function(e){e.O(0,[522,971,117,744],function(){return e(e.s=9732)}),_N_E=e.O()}]);